#!/usr/bin/env python

# todo: convert optparse to argparse if python version ever gets updated

from optparse import OptionParser
from dot_tools.git_tools import is_git, pull_request, GitException

def main():
    parser = OptionParser()
    parser.add_option(
        '-s',
        '--start_commit',
        default = None,
        help="Set the TEXT commit id at which to start the pull.  If unspecified, start from latest on origin/master",
        metavar = 'TEXT',
    )
    parser.add_option(
        '-c',
        '--compact',
        action = 'store_true',
        default = False,
        help="Generate a compact pull request",
    )
    (options, args) = parser.parse_args()

    if not is_git():
        parser.error("Can't generate a pull_request from a non-git directory")

    try:
        print(pull_request(start_commit=options.start_commit, compact=options.compact))
    except GitException as err:
        parser.error(err)

if __name__ == '__main__':
    main()

