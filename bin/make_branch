#!/usr/bin/env python

from argparse import ArgumentParser, ArgumentDefaultsHelpFormatter

from dot_tools.git_tools import is_git, make_github_branch, make_jira_branch
from dot_tools.misc_tools import DotException

if __name__ == '__main__':
    parser = ArgumentParser(
        formatter_class=ArgumentDefaultsHelpFormatter,
        description="Create a new git branch based on a github or JIRA issue",
    )
    parser.add_argument(
        'issue',
        help="The issue number to create a branch for",
    )
    parser.add_argument(
        '-b',
        '--base',
        help="the base for the new branch. Defaults to current branch",
    )
    parser.add_argument(
        '-j',
        '--jira',
        action='store_true',
        help="make jira branch instead of github",
    )
    parser.add_argument(
        '-v',
        '--verbose',
        action='store_true',
        help="print extra status messages",
    )
    args = parser.parse_args()
    DotException.require_condition(
        is_git(), "Command must be issued from a git repo"
    )
    make_branch = make_jira_branch if args.jira else make_github_branch
    make_branch(args.issue, base=args.base, verbose=args.verbose)
